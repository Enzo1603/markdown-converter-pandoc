<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <!-- Code Syntax Highlighting, Pandoc Default Pygments -->
  <style>
code {
font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
font-size: 85%;
margin: 0;
hyphens: manual;
}
pre {
margin: 1em 0;
overflow: auto;
}
pre code {
padding: 0;
overflow: visible;
overflow-wrap: normal;
}
.sourceCode {
background-color: transparent;
overflow: visible;
}
code {
white-space: pre-wrap;
}
.display.math {
display: block;
text-align: center;
margin: 0.5rem auto;
}
pre>code.sourceCode {
white-space: pre;
position: relative;
}
pre>code.sourceCode>span {
line-height: 1.25;
}
pre>code.sourceCode>span:empty {
height: 1.2em;
}
.sourceCode {
overflow: visible;
}
code.sourceCode>span {
color: inherit;
text-decoration: inherit;
}
div.sourceCode {
margin: 1em 0;
}
pre.sourceCode {
margin: 0;
}
@media screen {
div.sourceCode {
overflow: auto;
}
}
@media print {
pre>code.sourceCode {
white-space: pre-wrap;
}
pre>code.sourceCode>span {
display: inline-block;
text-indent: -5em;
padding-left: 5em;
}
}
pre.numberSource code {
counter-reset: source-line 0;
}
pre.numberSource code>span {
position: relative;
left: -4em;
counter-increment: source-line;
}
pre.numberSource code>span>a:first-child::before {
content: counter(source-line);
position: relative;
left: -1em;
text-align: right;
vertical-align: baseline;
border: none;
display: inline-block;
-webkit-touch-callout: none;
-webkit-user-select: none;
-khtml-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
padding: 0 4px;
width: 4em;
color: #aaaaaa;
}
pre.numberSource {
margin-left: 3em;
border-left: 1px solid #aaaaaa;
padding-left: 4px;
}
div.sourceCode {}
@media screen {
pre>code.sourceCode>span>a:first-child::before {
text-decoration: underline;
}
}
code span.al {
color: #ff0000;
font-weight: bold;
}
code span.an {
color: #60a0b0;
font-weight: bold;
font-style: italic;
}
code span.at {
color: #7d9029;
}
code span.bn {
color: #40a070;
}
code span.bu {
color: #008000;
}
code span.cf {
color: #007020;
font-weight: bold;
}
code span.ch {
color: #4070a0;
}
code span.cn {
color: #880000;
}
code span.co {
color: #60a0b0;
font-style: italic;
}
code span.cv {
color: #60a0b0;
font-weight: bold;
font-style: italic;
}
code span.do {
color: #ba2121;
font-style: italic;
}
code span.dt {
color: #902000;
}
code span.dv {
color: #40a070;
}
code span.er {
color: #ff0000;
font-weight: bold;
}
code span.ex {}
code span.fl {
color: #40a070;
}
code span.fu {
color: #134bd8;
}
code span.im {
color: #008000;
font-weight: bold;
}
code span.in {
color: #60a0b0;
font-weight: bold;
font-style: italic;
}
code span.kw {
color: #007020;
font-weight: bold;
}
code span.op {
color: #666666;
}
code span.ot {
color: #007020;
}
code span.pp {
color: #bc7a00;
}
code span.sc {
color: #4070a0;
}
code span.ss {
color: #bb6688;
}
code span.st {
color: #4070a0;
}
code span.va {
color: #19177c;
}
code span.vs {
color: #4070a0;
}
code span.wa {
color: #60a0b0;
font-weight: bold;
font-style: italic;
}
</style>


  <style>
body {
box-sizing: border-box;
min-width: 200px;
max-width: 980px;
margin: 0 auto;
padding: 45px;
}
div.sourceCode,
pre {
page-break-inside: avoid;

page-break-before: auto;

page-break-after: auto;

}
div.sourceCode,
pre {
white-space: pre-wrap;

word-wrap: break-word;

overflow-wrap: anywhere;

overflow: visible;

max-width: 100%;
}
</style>

    <link rel="stylesheet" href="statis/markdown-css/github-markdown-light.css">
  </head>

<body class="markdown-body" style="margin-left: auto; margin-right:auto;">
  <h1 id="vps-setup">VPS Setup</h1>
  <ul>
  <li>Server: Der VPS-Server bei IONOS</li>
  <li>Client: Gerät im Heimnetz (z. B. RaspberryPi)</li>
  </ul>
  <h2 id="firewall">Firewall</h2>
  <p>Gehe auf der IONOS-Webseite zu
  <code>Netzwerk &gt; Firewall-Richtlinien</code>: Füge deinem Server
  eine IPv6-Adresse hinzu (IPv4 sollte bereits zugewiesen sein). Setze
  mindestens folgende Regeln:</p>
  <ul>
  <li>TCP auf Port 22 (SSH)</li>
  <li>TCP auf Port 80 (HTTP, Nginx Proxy Manager)</li>
  <li>TCP auf Port 443 (HTTPS, Nginx Proxy Manager)</li>
  <li>UDP auf Port 51820 (WireGuard Tunnel)</li>
  <li>UDP z. B. auf Port 5544 (WireGuard VPN)</li>
  </ul>
  <h2 id="erstes-login-und-ändern-des-default-root-passworts">Erstes
  Login und ändern des Default-Root-Passworts</h2>
  <p>Melde dich über SSH an</p>
  <div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> root@<span class="op">&lt;</span>vps-ip-adresse<span class="op">&gt;</span></span></code></pre></div>
  <p>Ändere das Passwort</p>
  <div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">passwd</span></span></code></pre></div>
  <h2 id="system-aktualisieren">System aktualisieren</h2>
  <div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt upgrade</span></code></pre></div>
  <h2 id="erstelle-neuen-benutzer-und-deaktiviere-root-login-über-ssh">Erstelle
  neuen Benutzer und deaktiviere Root-Login über SSH</h2>
  <p>Neuen Benutzer erstellen</p>
  <div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">adduser</span> <span class="op">&lt;</span>username<span class="op">&gt;</span></span></code></pre></div>
  <p>Füge den Benutzer der sudo-Gruppe hinzu</p>
  <div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">usermod</span> <span class="at">-aG</span> sudo <span class="op">&lt;</span>username<span class="op">&gt;</span></span></code></pre></div>
  <p>Deaktiviere Root-Login über SSH. Ändere folgende Zeile oder füge
  sie der Datei <code>/etc/ssh/sshd_config</code> hinzu</p>
  <div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">PermitRootLogin</span> no</span></code></pre></div>
  <p>Starte den SSH-Dienst neu</p>
  <div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart ssh</span></code></pre></div>
  <p>Logge den Root aus und melde dich mit deinem neuen User an</p>
  <div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="op">&lt;</span>username<span class="op">&gt;</span>@<span class="op">&lt;</span>vps-ip-adresse<span class="op">&gt;</span></span></code></pre></div>
  <h2 id="passwortloses-ssh-login">Passwortloses SSH-Login</h2>
  <p>Kopiere deinen SSH-Key auf den Server, damit du dich ohne Passwort
  von deinem PC/Laptop aus einloggen kannst muss natürlich für jedes
  Gerät einzeln gemacht werden :(. (Gegebenenfalls muss zuerst noch ein
  SSH key generiert werden.)</p>
  <div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ssh-copy-id</span> <span class="op">&lt;</span>username<span class="op">&gt;</span>@<span class="op">&lt;</span>vps_ip_adresse<span class="op">&gt;</span></span></code></pre></div>
  <h2 id="installiere-wireguard-und-richte-es-für-den-tunnel-ein">Installiere
  WireGuard und richte es für den Tunnel ein</h2>
  <p>Stelle sicher, dass der Port in der IONOS-Firewall freigegeben
  ist!</p>
  <p>Installiere WireGuard</p>
  <div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install wireguard</span></code></pre></div>
  <p>Aktiviere das IP-Forwarding. Kommentiere folgende Zeilen aus in der
  Datei <code>/etc/sysctl.conf</code></p>
  <div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">net.ipv4.ip_forward=1</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># optional für IPv6 (für IPv6 muss gegebenenfalls dem VPS eine extra IPv6 noch zugewiesen werden über das IONOS Portal!)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">net.ipv6.conf.all.forwarding=1</span>  <span class="co"># Enabling this option disables Stateless Address Autoconfiguration based on Router Advertisements for this host</span></span></code></pre></div>
  <p>Lade die neuen IP-Forwarding-Einstellungen.</p>
  <div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> sysctl <span class="at">-p</span></span></code></pre></div>
  <p>Wechsle in <code>/etc/wireguard</code> und erstelle die WireGuard
  Schlüsselpaare für den Server</p>
  <div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">wg</span> genkey <span class="kw">|</span> <span class="fu">tee</span> server_private.key <span class="kw">|</span> <span class="ex">wg</span> pubkey <span class="op">&gt;</span> server_public.key</span></code></pre></div>
  <p>Erstelle <code>/etc/wireguard/wg0.conf</code>, um den
  WireGuard-Tunnel auf dem Server zu konfigurieren</p>
  <div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nano /etc/wireguard/wg0.conf</span></code></pre></div>
  <p>Füge die entsprechende Konfiguration ein. Ersetze
  <Server_Private_Key> mit dem Key in der Datei
  <code>server_private.key</code>. (<Client_Public_Key> kommt später.)
  <strong>Wichtig: Ersetze ‘ens6’ mit deinem gewünschten Network
  Interface (kann z. B. auch ‘eth0’ heissen; kann mit
  <code>ip addr</code> herausgefunden werden).</strong></p>
  <div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[Interface]</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">PrivateKey</span> = <span class="op">&lt;</span>Server_Private_Key<span class="op">&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Address</span> = 10.0.0.1/24, fd86:ea04:1115::1/64  <span class="co"># IPv6 optional</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ListenPort</span> = 51820</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ex">MTU</span> = 1400   <span class="co"># WICHTIG (sollte auf jeden Fall unter 1500 sein)</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># IP-Forwarding aktivieren (IPv4)</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="ex">PostUp</span> = iptables <span class="at">-A</span> FORWARD <span class="at">-i</span> wg0 <span class="at">-j</span> ACCEPT<span class="kw">;</span> <span class="ex">iptables</span> <span class="at">-t</span> nat <span class="at">-A</span> POSTROUTING <span class="at">-o</span> ens6 <span class="at">-j</span> MASQUERADE</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">PostDown</span> = iptables <span class="at">-D</span> FORWARD <span class="at">-i</span> wg0 <span class="at">-j</span> ACCEPT<span class="kw">;</span> <span class="ex">iptables</span> <span class="at">-t</span> nat <span class="at">-D</span> POSTROUTING <span class="at">-o</span> ens6 <span class="at">-j</span> MASQUERADE</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># IP-Forwarding aktivieren (IPv6) (optional)</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="ex">PostUp</span> = ip6tables <span class="at">-A</span> FORWARD <span class="at">-i</span> wg0 <span class="at">-j</span> ACCEPT<span class="kw">;</span> <span class="ex">ip6tables</span> <span class="at">-t</span> nat <span class="at">-A</span> POSTROUTING <span class="at">-o</span> ens6 <span class="at">-j</span> MASQUERADE</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="ex">PostDown</span> = ip6tables <span class="at">-D</span> FORWARD <span class="at">-i</span> wg0 <span class="at">-j</span> ACCEPT<span class="kw">;</span> <span class="ex">ip6tables</span> <span class="at">-t</span> nat <span class="at">-D</span> POSTROUTING <span class="at">-o</span> ens6 <span class="at">-j</span> MASQUERADE</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="ex">[Peer]</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="ex">PublicKey</span> = <span class="op">&lt;</span>Client_Public_Key<span class="op">&gt;</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="ex">AllowedIPs</span> = 10.0.0.0/24, 192.168.1.0/24, fd86:ea04:1115::/64   <span class="co"># IPv6 optional</span></span></code></pre></div>
  <h1 id="client-setup">Client Setup</h1>
  <h2 id="installiere-wireguard-und-richte-es-für-den-tunnel-ein-1">Installiere
  WireGuard und richte es für den Tunnel ein</h2>
  <p>Installiere WireGuard wie zuvor oben…</p>
  <ul>
  <li><code>apt install wireguard</code></li>
  <li>Editiere <code>/etc/sysctl.conf</code>, um IP-Forwarding zu
  aktivieren</li>
  <li><code>sudo sysctl -p</code>, um die neue
  IP-Forwarding-Konfiguration zu laden</li>
  </ul>
  <p>Erstelle das WireGuard-Schlüsselpaar für den Client</p>
  <div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /etc/wireguard</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">wg</span> genkey <span class="kw">|</span> <span class="fu">tee</span> client_private.key <span class="kw">|</span> <span class="ex">wg</span> pubkey <span class="op">&gt;</span> client_public.key</span></code></pre></div>
  <p>Erstelle <code>/etc/wireguard/wg0.conf</code>, um WireGuard auf dem
  Client für den WireGuard-Tunnel zu konfigurieren</p>
  <div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nano /etc/wireguard/wg0.conf</span></code></pre></div>
  <p>Füge die entsprechende Konfiguration ein. Ersetze
  <Client_Private_Key> mit dem Key in der Datei
  <code>client_private.key</code>. Ersetze <Server_Public_Key> mit dem
  Key in der Datei <code>server_public.key</code> auf dem Server.
  Ersetze <VPS_IPv4_Adresse> mit der öffentlichen IPv4-Adresse deines
  VPS-Servers. <strong>Wichtig: Ändere gegebenenfalls <code>eth0</code>
  zum korrekten Netzwerk-Interface.</strong></p>
  <div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[Interface]</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">PrivateKey</span> = <span class="op">&lt;</span>Client_Private_Key<span class="op">&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Address</span> = 10.0.0.2/24, fd86:ea04:1115::2/64  <span class="co"># IPv6 optional</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ListenPort</span> = 51820</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="ex">MTU</span> = 1400   <span class="co"># WICHTIG (sollte auf jeden Fall unter 1500 sein)</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># IP-Forwarding aktivieren (IPv4)</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="ex">PostUp</span> = iptables <span class="at">-A</span> FORWARD <span class="at">-i</span> wg0 <span class="at">-j</span> ACCEPT<span class="kw">;</span> <span class="ex">iptables</span> <span class="at">-t</span> nat <span class="at">-A</span> POSTROUTING <span class="at">-o</span> eth0 <span class="at">-j</span> MASQUERADE</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="ex">PostDown</span> = iptables <span class="at">-D</span> FORWARD <span class="at">-i</span> wg0 <span class="at">-j</span> ACCEPT<span class="kw">;</span> <span class="ex">iptables</span> <span class="at">-t</span> nat <span class="at">-D</span> POSTROUTING <span class="at">-o</span> eth0 <span class="at">-j</span> MASQUERADE</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># IP-Forwarding aktivieren (IPv6) (optional)</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="ex">PostUp</span> = ip6tables <span class="at">-A</span> FORWARD <span class="at">-i</span> wg0 <span class="at">-j</span> ACCEPT<span class="kw">;</span> <span class="ex">ip6tables</span> <span class="at">-t</span> nat <span class="at">-A</span> POSTROUTING <span class="at">-o</span> eth0 <span class="at">-j</span> MASQUERADE</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="ex">PostDown</span> = ip6tables <span class="at">-D</span> FORWARD <span class="at">-i</span> wg0 <span class="at">-j</span> ACCEPT<span class="kw">;</span> <span class="ex">ip6tables</span> <span class="at">-t</span> nat <span class="at">-D</span> POSTROUTING <span class="at">-o</span> eth0 <span class="at">-j</span> MASQUERADE</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="ex">[Peer]</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="ex">PublicKey</span> = <span class="op">&lt;</span>Server_Public_Key<span class="op">&gt;</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="ex">Endpoint</span> = <span class="op">&lt;</span>VPS_IPv4_Adresse<span class="op">&gt;</span>:51820</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="ex">AllowedIPs</span> = 10.0.0.0/24, fd86:ea04:1115::/64  <span class="co"># IPv6 optional</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="ex">PersistentKeepalive</span> = 20</span></code></pre></div>
  <h2 id="public-client-key-auf-server-wg0.conf">Public Client Key auf
  Server wg0.conf</h2>
  <p>Füge den Public-Key des Clients noch in die
  <code>/etc/wireguard/wg0.conf</code> deines Servers hinzu, da du sie
  jetzt kennst!</p>
  <h2 id="aktiviere-wireguard-sowohl-auf-dem-server-als-dem-client">Aktiviere
  WireGuard sowohl auf dem Server als dem Client</h2>
  <p>Aktiviere und starte WireGuard (auf dem Client <strong>und</strong>
  dem Server)</p>
  <div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable wg-quick@wg0</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl start wg-quick@wg0</span></code></pre></div>
  <p>Überprüfe, ob der Tunnel erfolgreich aufgebaut worden ist (“last
  handshake” sollte angezeigt werden, sonst stimmt was nicht).</p>
  <div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> wg show</span></code></pre></div>
  <h1 id="installation-des-nginx-proxy-managers">Installation des Nginx
  Proxy Managers</h1>
  <h2 id="installiere-docker-auf-dem-vps-server">Installiere Docker auf
  dem VPS-Server</h2>
  <p><a href="https://docs.docker.com/engine/install/debian/">Debian
  Docker Installation</a></p>
  <h2 id="installiere-nginx-proxy-manager">Installiere Nginx Proxy
  Manager</h2>
  <p>Erstelle den Ordner <code>~/npm</code></p>
  <div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ~/npm</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/npm</span></code></pre></div>
  <p>Erstelle <code>docker-compose.yml</code> und kopiere folgenden
  Inhalt hinein</p>
  <div class="sourceCode" id="cb22"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">app</span><span class="kw">:</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> jc21/nginx-proxy-manager:latest</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> npm</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> always</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 80:80</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 81:81</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 443:443</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> /PASS/MICH/AN/npm/data:/data</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> /PASS/MICH/AN/npm/letsencrypt:/etc/letsencrypt</span></span></code></pre></div>
  <p>Starte den Container mit</p>
  <div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> docker compose up <span class="at">-d</span></span></code></pre></div>
  <p>Leite Anfragen zum Client auf Port 82 über den WireGuard-Tunnel zum
  VPS auf Port 81 (damit Nginx Proxy Manager für die Erstkonfiguration
  von temporär vom Heimnetz aus erreichbar ist). Achtung: Das ist nicht
  persistent, nach einem Neustart ist diese Konfiguration wieder weg.
  Füge <code>npm.baraldi.ch</code> auf dem Proxy Manager hinzu, damit
  man ihn ab sofort über die URL erreichen kann. (Die Konfiguration
  unten wird danach nicht mehr beötigt und verschwindet automatisch nach
  einem Neustart wieder.)</p>
  <div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Für IPv4</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> iptables <span class="at">-t</span> nat <span class="at">-A</span> PREROUTING <span class="at">-p</span> tcp <span class="at">--dport</span> 82 <span class="at">-j</span> DNAT <span class="at">--to-destination</span> 10.0.0.1:81</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> iptables <span class="at">-t</span> nat <span class="at">-A</span> POSTROUTING <span class="at">-j</span> MASQUERADE</span></code></pre></div>
  <h1 id="wireguard-vpn-über-den-vps">WireGuard VPN über den VPS</h1>
  <p>Stelle sicher, dass in der IONOS-Firewall der entsprechende Port
  über UDP freigegeben ist. Sage dem VPS, er soll alles auf Port 5544
  über UDP an 192.168.1.20:5544 weiterleiten (Heimnetz WireGuard Docker
  Container).</p>
  <div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> iptables <span class="at">-t</span> nat <span class="at">-A</span> PREROUTING <span class="at">-p</span> udp <span class="at">--dport</span> 5544 <span class="at">-j</span> DNAT <span class="at">--to-destination</span> 192.168.1.20:5544</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> iptables <span class="at">-t</span> nat <span class="at">-A</span> POSTROUTING <span class="at">-j</span> MASQUERADE</span></code></pre></div>
  <p>Installiere iptables-persistent, um die iptables configs speichern
  zu können (zweimal ‘yes’), damit sie auch nach dem Neustart noch
  erhalten sind.</p>
  <div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install iptables-persistent</span></code></pre></div>
  <p>Normalerweise wird man bei der Installation gefragt, ob man die
  aktuelle Konfiguration speichern möchte. Manuell hiermit (am
  einfachsten unter <code>sudo su</code> ausführen):</p>
  <div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> iptables-save <span class="op">&gt;</span> /etc/iptables/rules.v4</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ip6tables-save <span class="op">&gt;</span> /etc/iptables/rules.v6   <span class="co"># optional</span></span></code></pre></div>
  <p>Setze den Docker Container auf</p>
  <div class="sourceCode" id="cb28"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">etc_wireguard</span><span class="kw">:</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">wg-easy</span><span class="kw">:</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">      # Change Language:</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">      # (Supports: en, ua, ru, tr, no, pl, fr, de, ca, es, ko, vi, nl, is, pt, chs, cht, it, th, hi, ja, si)</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> LANG=de</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">      # ⚠️ Required:</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">      # Change this to your host&#39;s public address</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> WG_HOST=87.106.70.163</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">      # Optional:</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">      # - PASSWORD_HASH=$$2y$$10$$hBCoykrB95WSzuV4fafBzOHWKu9sbyVa34GJr8VV5R/pIelfEMYyG (needs double $$, hash of &#39;foobar123&#39;; see &quot;How_to_generate_an_bcrypt_hash.md&quot; for generate the hash)</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> PORT=5545</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> WG_PORT=5544</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">      # - WG_CONFIG_PORT=92820</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">      # - WG_DEFAULT_ADDRESS=10.8.0.x</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co">      # - WG_DEFAULT_DNS=1.1.1.1</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">      # - WG_MTU=1420</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co">      # - WG_ALLOWED_IPS=192.168.15.0/24, 10.0.1.0/24</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co">      # - WG_PERSISTENT_KEEPALIVE=25</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co">      # - WG_PRE_UP=echo &quot;Pre Up&quot; &gt; /etc/wireguard/pre-up.txt</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co">      # - WG_POST_UP=echo &quot;Post Up&quot; &gt; /etc/wireguard/post-up.txt</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="co">      # - WG_PRE_DOWN=echo &quot;Pre Down&quot; &gt; /etc/wireguard/pre-down.txt</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co">      # - WG_POST_DOWN=echo &quot;Post Down&quot; &gt; /etc/wireguard/post-down.txt</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="co">      # - UI_TRAFFIC_STATS=true</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="co">      # - UI_CHART_TYPE=0 # (0 Charts disabled, 1 # Line chart, 2 # Area chart, 3 # Bar chart)</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="co">      # - WG_ENABLE_ONE_TIME_LINKS=true</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="co">      # - UI_ENABLE_SORT_CLIENTS=true</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="co">      # - WG_ENABLE_EXPIRES_TIME=true</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="co">      # - ENABLE_PROMETHEUS_METRICS=false</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="co">      # - PROMETHEUS_METRICS_PASSWORD=$$2a$$12$$vkvKpeEAHD78gasyawIod.1leBMKg8sBwKW.pQyNsq78bXV3INf2G # (needs double $$, hash of &#39;prometheus_password&#39;; see &quot;How_to_generate_an_bcrypt_hash.md&quot; for generate the hash)</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> ghcr.io/wg-easy/wg-easy</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> wg-easy</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> etc_wireguard:/etc/wireguard</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;5544:5544/udp&quot;</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;5545:5545/tcp&quot;</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">cap_add</span><span class="kw">:</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> NET_ADMIN</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SYS_MODULE</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="co">      # - NET_RAW # ⚠️ Uncomment if using Podman</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">sysctls</span><span class="kw">:</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> net.ipv4.ip_forward=1</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> net.ipv4.conf.all.src_valid_mark=1</span></span></code></pre></div>
</body>

</html>